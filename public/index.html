<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title> LabSystem Pro - Gesti√≥n de Examennes-Resultados-Pacientes</title>
    <style>
        :root { --main: #1e293b; --accent: #3b82f6; }
        body { display: flex; font-family: 'Segoe UI', sans-serif; margin: 0; background: #f8fafc; }
        nav { width: 260px; background: var(--main); color: white; height: 100vh; padding: 20px; position: fixed; }
        nav li { padding: 15px; cursor: pointer; list-style: none; border-radius: 8px; transition: 0.3s; }
        nav li:hover { background: #334155; }
        main { margin-left: 300px; padding: 40px; width: 100%; }
        .card { background: white; padding: 30px; border-radius: 15px; shadow: 0 4px 6px rgba(0,0,0,0.1); }
        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        th { background: #f1f5f9; padding: 12px; text-align: left; }
        td { padding: 12px; border-bottom: 1px solid #e2e8f0; }
        .btn-del { color: #ef4444; cursor: pointer; border: none; background: none; font-size: 1.2rem; }
    </style>
</head>
<body>
    <nav>
        <h2>üî¨ LabSystem v2</h2>
        <ul id="menu">
            <li onclick="switchModulo('pacientes')">Pacientes</li>
            <li onclick="switchModulo('medicos')">M√©dicos</li>
            <li onclick="switchModulo('examenes')">Orden de Examen</li>
            <li onclick="switchModulo('resultados')">Resultados Finales</li>
        </ul>
    </nav>
    <main>
        <div class="card">
            <h1 id="mod-title">Gesti√≥n de Pacientes</h1>
            <table id="data-table">
                <thead id="table-head"></thead>
                <tbody id="table-body"></tbody>
            </table>
        </div>
    </main>

    <script>
        let moduloActual = 'pacientes';
        const config = {
            pacientes: { cols: ['Nombre', 'CI', 'Tel√©fono'], keys: ['nombre', 'ci', 'telefono'] },
            medicos: { cols: ['Nombre', 'Especialidad', 'MPPS'], keys: ['nombre', 'especialidad', 'mpps'] },
            examenes: { cols: ['N¬∞ Orden', 'Examen', 'M√©dico'], keys: ['numeroOrden', 'nombre', 'medicoId.nombre'] },
            resultados: { cols: ['N¬∞ Orden', 'Paciente', 'Valor'], keys: ['numeroOrden', 'pacienteId.nombre', 'valor'] }
        };

        async function switchModulo(mod) {
            moduloActual = mod;
            document.getElementById('mod-title').innerText = `Gesti√≥n de ${mod.toUpperCase()}`;
            renderTable();
        }

        async function renderTable() {
            const head = document.getElementById('table-head');
            const body = document.getElementById('table-body');
            const conf = config[moduloActual];

            head.innerHTML = `<tr>${conf.cols.map(c => `<th>${c}</th>`).join('')}<th>Acciones</th></tr>`;
            
            const res = await fetch(`/api/${moduloActual}`);
            const data = await res.json();

            body.innerHTML = data.map(item => `
                <tr>
                    ${conf.keys.map(key => {
                        // L√≥gica para acceder a objetos anidados (ej: medicoId.nombre)
                        const value = key.split('.').reduce((o, i) => (o ? o[i] : '-'), item);
                        return `<td>${value || '-'}</td>`;
                    }).join('')}
                    <td><button class="btn-del" onclick="eliminar('${item._id}')">üóëÔ∏è</button></td>
                </tr>
            `).join('');
        }

        async function eliminar(id) {
            if(confirm('¬øEliminar registro?')) {
                await fetch(`/api/${moduloActual}/${id}`, { method: 'DELETE' });
                renderTable();
            }
        }

        window.onload = () => switchModulo('pacientes');
    </script>
</body>
</html>